name: "Deploy Storybook with Chromatic"

on:
  pull_request:
    # PRì— ë‹¤ìŒ íŒŒì¼ë“¤ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰
    paths:
      - "**/*.stories.ts"
      - "**/*.stories.tsx"
      - ".storybook/**"

jobs:
  chromatic:
    name: Run Chromatic
    runs-on: ubuntu-latest # ìµœì‹  Ubuntu í™˜ê²½ì—ì„œ ì‹¤í–‰
    steps:
      - name: Checkout code
        uses: actions/checkout@v4 # ì €ì¥ì†Œ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        with:
          fetch-depth: 0

      - uses: actions/setup-node@v4 # Node.js í™˜ê²½ ì„¤ì •
        with:
          node-version: 22.x # Node.js 22 ë²„ì „ ì‚¬ìš©

      - name: Install dependencies
        run: npm ci # lockfile ê¸°ë°˜ìœ¼ë¡œ ì˜ì¡´ì„± ì„¤ì¹˜ (ì—„ê²©í•œ ì¼ê´€ì„± ë³´ì¥)

      - name: Build Storybook
        run: npm run build-storybook # ì •ì  Storybook ì‚¬ì´íŠ¸ ë¹Œë“œ

      - name: Run Chromatic
        id: chromatic
        uses: chromaui/action@latest # Chromaticì— Storybook ë°°í¬
        with:
          projectToken: ${{ secrets.FE_CHROMATIC_PROJECT_TOKEN }} # Chromatic í”„ë¡œì íŠ¸ í† í°
          token: ${{ secrets.GITHUB_TOKEN }} # GitHub ì¸ì¦ìš© í† í°

      - name: Comment PR
        uses: thollander/actions-comment-pull-request@v2 # PRì— ì½”ë©˜íŠ¸ ë‚¨ê¸°ëŠ” ì•¡ì…˜
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # ì½”ë©˜íŠ¸ ê¶Œí•œì„ ìœ„í•œ í† í°
        with:
          message: "ğŸš€storybook: ${{ steps.chromatic.outputs.storybookUrl }}" # ë°°í¬ëœ Storybook ë§í¬ ì½”ë©˜íŠ¸ë¡œ ì¶”ê°€
